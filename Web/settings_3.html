<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accout Settings</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="getValuesFromDatabase()">
    <div class= "settingsBackground">
    </div>
    <div class = "backgroundDim">
    </div>
    
    <nav class = "navigationMenu">
    <div>
    <ul>
        <li><a href="home.html" title="Home"> Home </a></li>
        <li><a href="linking.html" title="Linking"> Linking </a></li>
        <li><a href="#" title="My History"> My History </a></li>
        <li><a href="history.html" title="File Manager"> File Manager</a></li>
        <li><a href="#" title="Account Settings"> Account Settings</a></li>
        <li><a href="prehome.html" title="Logout"> Logout </a></li>
    </ul>
    </div>
    </nav>

    <div class = "settingsFrame">

        <div class = "settingsMenu">
            <nav class = "navigationSettings">
            <div>
            <ul>
                <li><a href="settings_1.html">
                <img src="./images/settings/personal_info2.svg" class = "ico" alt = "logo personal info">
                Personal Info 
                </a></li>

                <li><a href="settings_2.html">
                <img src="./images/settings/account_security.svg" class = "ico" alt = "logo account security"> 
                Account Security 
                </a></li>

                <li><a href="settings_3.html">
                <img src="./images/settings/clouds_settings.svg" class = "ico" alt = "logo clouds settings"> 
                Clouds Settings 
                </a></li>
                
                <li><a href="settings_4.html">
                <img src="./images/settings/advanced_settings.svg" class = "ico" alt = "logo advanced settings"> 
                Bandwidth
                </a></li>
            </ul>
            </div>
            </nav>
        </div>


        <div class = "settingsContent">
        <div class = "settingsPersonalInfo">
        
            <div class = "settingsTopSide">
                <p>Clouds Settings</p>
                <button class="button" onclick="applyValues()">Apply</button>
            </div>

            <div class = "settingsBotSide">
            <div class = "flexContainerSettings2">
                <div> <br>
                <label for="Upload method">Upload method</label>

                <label class="container">
                    Focus all the files uploaded towards the prefered cloud (if possible)
                    <input id="checked1" type="radio" checked="checked" name="radio">
                    <span class="checkmark"></span>
                </label>
                <label class="container">
                    Split the uploaded files in equal chunks for available clouds
                    <input id="checked2" type="radio" name="radio">
                    <span class="checkmark"></span>
                </label>
                <label class="container">
                    Split the uploaded files in chunks proportional to the size of each cloud
                    <input id="checked3" type="radio" name="radio">
                    <span class="checkmark"></span>
                </label>
                </div>

                <div> <br>
                    <label for="preferedOrder"> Preference Order</label>
                    
                    <div class = "flexContainerPreference">
                    
                    <div> <br>
                        <img class="minilogo" src="./images/prehome/Google_Drive_Icon.png" alt="Google Drive Logo">
                        <input type="number" id="preference1" name="quantity" min="1" max="3" value="1">
                        <br>
                    </div>
                    
                    <div> <br>
                        <img class="minilogo" src="./images/prehome/Dropbox_Icon.png" alt="DropBox Logo">
                        <input type="number" id="preference2" name="quantity" min="1" max="3" value="2">
                        <br>
                    </div>
                    
                    <div> <br>
                        <img class="minilogo" src="./images/prehome/Microsoft_OneDrive_Icon.png" alt="Microsoft OneDrive">
                        <input type="number" id="preference3" name="quantity" min="1" max="3" value="3">
                        <br>
                    </div> 
                    
                    </div>
                </div>



            </div>
            </div>
        </div>
        </div>

    </div>

    <script>
        async function digestMessage(message) {
            const msgUint8 = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        async function getValuesFromDatabase()
        {
            // aici se vor seta field-urile din aceasta pagina, flower power

            let userID = localStorage.getItem("stol_owner_id");


            var url = 'http://127.0.0.1:3000/' + userID + '/user/3';
            const response = await fetch(url, {
                method: 'GET'
            });
            const myJson = await response.json();

            console.log(myJson);

            // here it must be modified to use the result json
            document.getElementById("checked1").checked = false;
            document.getElementById("checked2").checked = false;
            document.getElementById("checked3").checked = false;

            document.getElementById("preference1").value = myJson["cloud_settings"]["order"][0];
            document.getElementById("preference2").value = myJson["cloud_settings"]["order"][1];
            document.getElementById("preference3").value = myJson["cloud_settings"]["order"][2];


            document.getElementById("checked" + myJson["cloud_settings"]["method"]).checked = true;

        }

        async function applyValues()
        {
            let method = "";
            if(document.getElementById("checked1").checked === true)
            {
                method = "1";
            }
            else if(document.getElementById("checked2").checked === true)
            {
                method = "2";
            }
            else
            {
                method = "3";
            }

            let userID = localStorage.getItem("stol_owner_id");

            let order = document.getElementById("preference1").value + document.getElementById("preference2").value + document.getElementById("preference3").value


            var url = 'http://127.0.0.1:3000/' + userID + '/user/3';
            console.log(url);
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({method : method, order : order})
            });
            const myJson = await response.json();

            console.log(myJson);

        }
    </script>

</body>
</html>