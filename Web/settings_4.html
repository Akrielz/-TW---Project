<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accout Settings</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="getValuesFromDatabase()">
    <div class= "settingsBackground">
    </div>
    <div class = "backgroundDim">
    </div>
    
    <nav class = "navigationMenu">
    <div>
    <ul>
        <li><a href="home.html" title="Home"> Home </a></li>
        <li><a href="linking.html" title="Linking"> Linking </a></li>
        <li><a href="#" title="My History"> My History </a></li>
        <li><a href="history.html" title="File Manager"> File Manager</a></li>
        <li><a href="#" title="Account Settings"> Account Settings</a></li>
        <li><a href="prehome.html" title="Logout"> Logout </a></li>
    </ul>
    </div>
    </nav>

    <div class = "settingsFrame">

        <div class = "settingsMenu">
            <nav class = "navigationSettings">
            <div>
            <ul>
                <li><a href="settings_1.html">
                <img src="./images/settings/personal_info2.svg" class = "ico" alt = "logo personal info">
                Personal Info 
                </a></li>

                <li><a href="settings_2.html">
                <img src="./images/settings/account_security.svg" class = "ico" alt = "logo account security"> 
                Account Security 
                </a></li>

                <li><a href="settings_3.html">
                <img src="./images/settings/clouds_settings.svg" class = "ico" alt = "logo clouds settings"> 
                Clouds Settings 
                </a></li>
                
                <li><a href="settings_4.html">
                <img src="./images/settings/advanced_settings.svg" class = "ico" alt = "logo advanced settings"> 
                Bandwidth
                </a></li>
            </ul>
            </div>
            </nav>
        </div>


        <div class = "settingsContent">
        <div class = "settingsPersonalInfo">
        
            <div class = "settingsTopSide">
                <p>Bandwidth</p>
                <button class="button" onclick="applyValues()">Apply</button>
            </div>

            <div class = "settingsBotSide">
            <div class = "flexContainerSettings2">
                <div> <br>
                    <label for="maxStorage"> Max Storage Allowed (MB)</label>
                    
                    <div class = "flexContainerPreference">
                    <div> <br>
                        <img class="minilogo" src="./images/prehome/Google_Drive_Icon.png" alt="Google Drive Logo">
                        <input type="number" id="preference1" name="quantity" min="0" value="4096">
                        <br>
                    </div>

                    <div> <br>
                        <img class="minilogo" src="./images/prehome/Dropbox_Icon.png" alt="DropBox Logo">
                        <input type="number" id="preference2" name="quantity" min="0" value="2048">
                        <br>
                    </div>

                    <div> <br>
                        <img class="minilogo" src="./images/prehome/Microsoft_OneDrive_Icon.png" alt="Microsoft OneDrive">
                        <input type="number" id="preference3" name="quantity" min="0" value="9216">
                        <br>
                    </div> 
                    </div>
                </div>

                <div>
                    <label for="download"> Maximum Download Speed (KB/S) </label>
                    <input type="number" id="download" name="download" value="4096">
                </div>

                <div>
                    <label for="upload"> Maximum Upload Speed (KB/S) </label>
                    <input type="number" id="upload" name="upload" value="2048">
                </div>
            </div>
            </div>
        </div>
        </div>

    </div>

    <script>
        async function digestMessage(message) {
            const msgUint8 = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        async function getValuesFromDatabase()
        {
            // aici se vor seta field-urile din aceasta pagina, flower power

            let userID = localStorage.getItem("stol_owner_id");


            var url = 'http://127.0.0.1:3000/' + userID + '/user/4';
            const response = await fetch(url, {
                method: 'GET'
            });
            const myJson = await response.json();

            console.log(myJson);

            // here it must be modified to use the result json

            document.getElementById("preference1").value = myJson["bandwidth"]["storage_google"];
            document.getElementById("preference2").value = myJson["bandwidth"]["storage_dropbox"];
            document.getElementById("preference3").value = myJson["bandwidth"]["storage_onedrive"];

            document.getElementById("download").value = myJson["bandwidth"]["max_download"];
            document.getElementById("upload").value = myJson["bandwidth"]["max_upload"];


        }

        async function applyValues()
        {
            let userID = localStorage.getItem("stol_owner_id");

            let google = document.getElementById("preference1").value;
            let dropbox = document.getElementById("preference2").value;
            let onedrive = document.getElementById("preference3").value;

            let download = document.getElementById("download").value;
            let upload = document.getElementById("upload").value;

            var url = 'http://127.0.0.1:3000/' + userID + '/user/4';
            console.log(url);
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({storage_google : google, storage_dropbox : dropbox, storage_onedrive: onedrive, max_download: download, max_upload: upload})
            });
            const myJson = await response.json();

            console.log(myJson);

        }
    </script>

</body>
</html>
